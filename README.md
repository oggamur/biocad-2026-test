# Biocad 2026 Test Project

Веб-приложение для управления и мониторинга устройств с дашбордом и детальным просмотром.

## Технологии

- **Node.js** - серверная платформа
- **Express.js** - веб-фреймворк
- **Нативный JavaScript (ES6 Modules)** - клиентская логика
- **HTML5** - разметка
- **SCSS (Sass)** - препроцессор стилей
- **Flatpickr** - библиотека для выбора даты и времени
- **date-fns** - утилиты для работы с датами

## Структура проекта

```
biocad-2026-test/
├── server.js                    # Node.js сервер (Express)
├── package.json                 # Зависимости и скрипты проекта
├── package-lock.json            # Зафиксированные версии зависимостей
├── links.json                   # Файл с ссылками на деплой и код
│
├── scss/                        # SCSS исходники
│   ├── _variables.scss          # Переменные (цвета, типографика, отступы)
│   ├── _mixins.scss             # Миксины (переиспользуемые стили)
│   ├── _base.scss               # Базовые стили
│   ├── _header.scss             # Стили шапки
│   ├── _layout.scss             # Стили layout
│   ├── _device-card.scss        # Стили карточек устройств
│   ├── _device-detail.scss      # Стили детального просмотра
│   ├── _error.scss              # Стили страницы ошибки
│   ├── _responsive.scss         # Адаптивные стили
│   └── main.scss                # Главный файл (импортирует все модули)
│
└── public/                      # Статические файлы
    ├── dashboards.html          # Страница дашбордов
    ├── device-detail.html       # Страница детального просмотра устройства
    ├── error.html               # Страница ошибки
    │
    ├── css/
    │   ├── styles.css           # Скомпилированные стили (генерируется из SCSS)
    │   └── styles.css.map       # Source map для отладки
    │
    ├── images/
    │   ├── avatar/              # Аватары пользователей
    │   │   ├── avatar.jpg
    │   │   └── unknown-avatar.svg
    │   ├── devices/             # Изображения устройств (SVG)
    │   │   ├── bio-box.svg
    │   │   ├── devices-list.json
    │   │   ├── osmometer.svg
    │   │   ├── unknown-item.svg
    │   │   └── ventilation.svg
    │   └── logo/
    │       └── page-logo.svg    # Логотип приложения
    │
    └── js/
        ├── dashboards.js        # Логика дашборда (рендеринг карточек, навигация)
        ├── device-images.js     # Маппинг типов устройств на изображения
        ├── deviceStates.js      # Управление состояниями устройств (localStorage)
        ├── favorites.js         # Управление избранными устройствами (localStorage)
        │
        └── device-detail/       # Модули детального просмотра
            ├── main.js          # Точка входа (инициализация)
            ├── state.js         # Управление состоянием (пагинация, сортировка, фильтры)
            ├── rendering.js     # Функции рендеринга HTML
            ├── setup.js         # Настройка event listeners
            ├── sorting.js       # Логика сортировки и фильтрации
            ├── dateFilter.js    # Логика фильтрации по дате
            └── utils.js         # Вспомогательные функции
```

## Функциональность

### Дашборд (`dashboards.html`)
- Отображение сетки карточек устройств
- Фильтрация по состоянию (свободно, у вас, занято, работа)
- Избранное (добавление/удаление устройств)
- Изменение состояния устройств (свободно ↔ у вас)
- Навигация на детальную страницу устройства

### Детальная страница (`device-detail.html`)
- **Вкладка "Analytics":**
  - Таблица с данными о работе устройства
  - Фильтрация по дате (диапазон дат с Flatpickr)
  - Фильтрация по виду работ
  - Фильтрация по пользователю
  - Сортировка по дате и времени
  - Сортировка по пользователю (алфавитная)
  - Пагинация с выбором количества записей на странице
  - Временные чипы (День, Неделя, 2 недели, Месяц, 3 месяца, Полгода)
  - Экспорт в PDF (модальное окно)
  
- **Вкладка "Description":**
  - Детальная информация об устройстве
  - ID, серийный номер, паспорт ID, EO, название, производитель

### Общие функции
- Глобальное состояние устройств (localStorage)
- Глобальное избранное (localStorage)
- Модальные окна для неподдерживаемых функций
- Адаптивный дизайн
- Максимальная ширина контента: 1340px

## Установка и запуск

### 1. Установка зависимостей
```bash
npm install
```

### 2. Разработка
Запуск сервера с автоматической компиляцией SCSS при изменениях:
```bash
npm run dev
```

### 3. Продакшн
Компиляция SCSS и запуск сервера:
```bash
npm start
```

Сервер автоматически скомпилирует SCSS перед запуском благодаря хуку `prestart`.

### 4. Отдельные команды
```bash
# Компиляция SCSS в CSS
npm run build:css

# Автоматическая компиляция SCSS при изменениях
npm run watch:css

# Запуск только сервера (требует предварительной компиляции CSS)
node server.js
```

### 5. Открыть в браузере
```
http://localhost:3000
```

## API Endpoints

- `GET /` - Главная страница (редирект на `/dashboards`)
- `GET /dashboards` - Страница дашбордов
- `GET /device-detail?id={deviceId}` - Детальная страница устройства
- `GET /api/devices` - Список всех устройств
- `GET /api/devices/:id` - Данные конкретного устройства
- `GET /api/detailed-data/:id` - Детальные данные устройства (для Analytics и Description)
- `PUT /api/devices/:id/state` - Обновление состояния устройства
- `GET /error` - Страница ошибки

## Особенности реализации

- **Модульная архитектура:** JavaScript код разбит на модули для лучшей поддерживаемости
- **SCSS модули:** Стили организованы в отдельные файлы по компонентам
- **ES6 Modules:** Использование `import/export` для организации кода
- **LocalStorage:** Сохранение состояния избранного и состояний устройств
- **Event delegation:** Правильное управление event listeners для предотвращения утечек памяти
- **Динамическая пагинация:** Клиентская пагинация с настраиваемым количеством записей
- **Множественная фильтрация:** Одновременная работа фильтров по дате, виду работ и пользователю

## Зависимости

### Production
- `express` - веб-фреймворк
- `cors` - обработка CORS
- `flatpickr` - выбор даты и времени
- `date-fns` - утилиты для работы с датами

### Development
- `sass` - компилятор SCSS
- `concurrently` - параллельный запуск команд
